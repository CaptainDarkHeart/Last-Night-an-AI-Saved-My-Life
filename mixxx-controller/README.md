# Mixxx AI DJ Controller (Layer 4)

**Automated DJ performance system for Mixxx that executes playlists from the Track Selection Engine.**

---

## Overview

This Mixxx controller script automatically performs DJ sets using playlists generated by the Track Selection Engine (Layer 3). It handles:

- âœ… **Extended blends** (60-90 seconds)
- âœ… **Beatmatching** and tempo sync
- âœ… **Automatic crossfading**
- âœ… **Transition execution**
- âœ… **Energy-aware mixing**

---

## Architecture

```
Track Selection Engine (Layer 3)
         â†“
    Generates playlist.json
         â†“
    playlist_loader.py (converts to Mixxx format)
         â†“
    AI_DJ_Controller.js (Mixxx controller script)
         â†“
    Mixxx DJ Software (automated performance)
```

---

## Installation

### 1. Find Mixxx Controllers Directory

**macOS:**
```
~/Library/Application Support/Mixxx/controllers/
```

**Linux:**
```
~/.mixxx/controllers/
```

**Windows:**
```
%LOCALAPPDATA%\Mixxx\controllers\
```

### 2. Copy Controller Files

```bash
cp AI_DJ_Controller.js ~/Library/Application\ Support/Mixxx/controllers/
cp AI_DJ_Controller.midi.xml ~/Library/Application\ Support/Mixxx/controllers/
```

### 3. Enable in Mixxx

1. Open Mixxx
2. Go to **Preferences > Controllers**
3. Find **AI DJ Controller** in the list
4. Click **Enable**
5. Click **OK**

---

## Usage

### Step 1: Generate Playlist (Layer 3)

```bash
cd track-selection-engine
PYTHONPATH=src python3 -m track_selector.cli generate 180 \
  --library traktor-library-detailed.json \
  --output my-dj-set \
  --progression gradual_build \
  --blend 75 \
  --m3u
```

This creates `my-dj-set.json`

### Step 2: Convert for Mixxx

```bash
cd mixxx-controller
python3 playlist_loader.py ../track-selection-engine/my-dj-set.json
```

This creates:
- `my-dj-set.mixxx.js` - Loader script
- `my-dj-set.ai-dj.m3u` - Enhanced M3U with metadata

### Step 3: Load in Mixxx

#### Option A: Developer Console (Recommended for Testing)

1. Open Mixxx
2. Go to **Developer Tools > Developer Console** (Ctrl+D or Cmd+D)
3. Load the script:
   ```javascript
   load("/path/to/my-dj-set.mixxx.js");
   ```
4. Start performance:
   ```javascript
   AI_DJ_Controller.start();
   ```

#### Option B: Import M3U Playlist

1. In Mixxx, go to **Library > Playlists**
2. Right-click > **Import Playlist**
3. Select `my-dj-set.ai-dj.m3u`
4. The controller will automatically detect and use it

---

## Controller API

### Configuration

```javascript
// Adjust blend duration
AI_DJ_Controller.config.blendDuration = 90;  // seconds

// Enable/disable sync
AI_DJ_Controller.config.enableSync = true;

// Enable logging
AI_DJ_Controller.config.enableLogging = true;
```

### Control Functions

```javascript
// Load playlist manually
AI_DJ_Controller.loadPlaylist(playlistObject);

// Start automated performance
AI_DJ_Controller.start();

// Stop performance
AI_DJ_Controller.stop();
```

---

## How It Works

### 1. Playlist Loading

The controller reads the playlist JSON containing:
- Track list with BPM, energy, duration
- Transition points with blend durations
- Mixing strategies

### 2. Playback Monitoring

Every 100ms, the controller checks:
- Current playback position
- Time remaining in track
- Upcoming transition timing

### 3. Transition Execution

When transition point is reached:
1. Load next track on inactive deck
2. Beatmatch using Mixxx sync
3. Start next deck playing
4. Execute crossfade over blend duration
5. Swap decks when complete

### 4. Crossfading

Linear volume crossfade:
```
Deck A: 100% â†’ 0% (over blend duration)
Deck B: 0% â†’ 100% (over blend duration)
```

---

## Features

### Extended Blends (60-90 seconds)

Configured per-transition in playlist:
```json
{
  "blend_duration": 75,
  "strategy": "extended_blend"
}
```

### Beatmatching

Uses Mixxx's built-in sync:
```javascript
engine.setValue("[Channel2]", "sync_enabled", 1);
```

### Energy Progression

Follows energy curve from journey arc:
```
2-3-4 (opening) â†’ 5-6 (build) â†’ 7-8 (peak) â†’ 5-6 (descent)
```

---

## Limitations & Future Enhancements

### Current Limitations

1. **Track Loading**: Requires tracks to be pre-loaded in Mixxx library
2. **No Real-time Audio Analysis**: Uses pre-analyzed BPM/energy data
3. **Linear Crossfade**: Could use more sophisticated blending
4. **No EQ Manipulation**: Doesn't yet swap bass/treble during blends

### Planned Enhancements

#### Phase 1: Enhanced Mixing
- [ ] EQ-based transitions (bass swap, treble blending)
- [ ] Exponential/logarithmic crossfade curves
- [ ] Loop-based extensions
- [ ] Effect automation (reverb, delay, filter)

#### Phase 2: Intelligent Loading
- [ ] Automatic track search by artist/title
- [ ] File path resolution
- [ ] Library integration

#### Phase 3: Advanced Features
- [ ] Cue point detection and usage
- [ ] Phrase-aware mixing
- [ ] Key-based harmonic mixing
- [ ] Manual override controls

#### Phase 4: MCP Integration
- [ ] Connect to AI DJ MCP Server (Layer 2)
- [ ] Real-time cue point analysis
- [ ] Dynamic playlist adjustment
- [ ] Claude control interface

---

## Troubleshooting

### Controller not appearing in Mixxx

**Solution:** Ensure both `.js` and `.midi.xml` files are in the controllers directory and restart Mixxx.

### Script errors in console

**Solution:** Check JavaScript syntax. Open Mixxx with console visible to see errors.

### Tracks not loading

**Solution:** Currently, tracks must be manually loaded. Use M3U import method or add tracks to Mixxx library first.

### Beatmatching not working

**Solution:**
- Ensure `sync_enabled` is working in Mixxx
- Verify BPM detection in Mixxx matches playlist data
- Check that tracks have valid beat grids

### Crossfade too fast/slow

**Solution:** Adjust blend duration in playlist or config:
```javascript
AI_DJ_Controller.config.blendDuration = 90;
```

---

## Development

### Testing

1. Create a small test playlist (3-5 tracks)
2. Load in Mixxx developer console
3. Monitor console for log messages
4. Watch deck behavior and crossfades

### Debugging

Enable verbose logging:
```javascript
AI_DJ_Controller.config.enableLogging = true;
```

Watch console for:
- Track loading events
- Transition timing
- Beatmatch status
- Crossfade progress

### Extending

The controller is modular. You can add:
- Custom transition strategies
- EQ manipulation
- Effect chains
- Loop management
- Cue point handling

---

## File Structure

```
mixxx-controller/
â”œâ”€â”€ AI_DJ_Controller.js           # Main controller script
â”œâ”€â”€ AI_DJ_Controller.midi.xml     # Mixxx controller definition
â”œâ”€â”€ playlist_loader.py             # Playlist conversion utility
â”œâ”€â”€ README.md                      # This file
â””â”€â”€ INSTALLATION.md                # Installation guide
```

---

## Integration with Other Layers

### Layer 1: Knowledge Base
- Your deep space house philosophy guides playlist generation

### Layer 2: AI DJ MCP Server
- Can analyze tracks for cue points
- Future: Real-time analysis during performance

### Layer 3: Track Selection Engine
- Generates playlists with transitions
- Provides BPM, energy, duration data

### Layer 4: Mixxx Controller (Current)
- Executes automated DJ performance
- Handles beatmatching and crossfading

---

## Performance Tips

### For Best Results

1. **Pre-analyze tracks in Mixxx** - Ensure beat grids are accurate
2. **Use consistent BPM range** - 115-130 BPM works well
3. **Test transitions manually first** - Verify tracks mix well
4. **Start with shorter blends** - 30-45s, then increase to 75-90s
5. **Monitor first performance** - Watch for timing issues

### Recommended Workflow

1. Generate playlist with Track Selection Engine
2. Import M3U to Mixxx
3. Verify all tracks load correctly
4. Analyze beat grids in Mixxx
5. Load playlist script
6. Start AI DJ Controller
7. Supervise first run

---

## Next Steps

1. **Install controller files** in Mixxx
2. **Generate a test playlist** (30-60 minutes)
3. **Convert with playlist_loader.py**
4. **Test in Mixxx** developer console
5. **Refine and iterate**

---

## Credits

Built on top of:
- **Mixxx** - Open-source DJ software
- **Track Selection Engine (Layer 3)** - Playlist generation
- **AI DJ MCP Server (Layer 2)** - Audio analysis
- **Deep Space House Knowledge Base (Layer 1)** - Mixing philosophy

---

**You now have a complete automated DJ system!** ðŸš€ðŸŽ§

From music analysis to automated performance, all four layers working together.
